VacuaGym Pipeline Flow - Visual Guide
=====================================

OPTION A: ONE-CLICK SOLUTION (Recommended)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  jupyter notebook                        â”‚
   â”‚  VacuaGym_Complete_Pipeline.ipynb       â”‚
   â”‚                                          â”‚
   â”‚  Then: Cell â†’ Run All                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  âœ“ Validates V1 (shows 98% failure)     â”‚
   â”‚  âœ“ Generates V2 labels (60-85% success) â”‚
   â”‚  âœ“ Validates V2 quality                 â”‚
   â”‚  âœ“ Creates train/val/test splits        â”‚
   â”‚  âœ“ Trains baseline models               â”‚
   â”‚  âœ“ Produces diagnostics & plots         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  DONE! Check publication readiness      â”‚
   â”‚  Output: data/processed/labels/         â”‚
   â”‚          toy_eft_stability_v2.parquet   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


OPTION B: MANUAL STEP-BY-STEP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Step 1: Test V2 Fixes (2 min)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ .venv/bin/python                          â”‚
â”‚   scripts/test_phase3_v2.py              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”œâ”€ PASS â†’ Continue to Step 2
                 â”‚
                 â””â”€ FAIL â†’ Debug, check errors
                            Review CRITICAL_FIXES_SUMMARY.md
                    â”‚
                    â–¼

Step 2: Generate Labels (2-4 hours full, 10 min test)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Configure N_LIMIT in script:              â”‚
â”‚   N_LIMIT = 1000  (test)                 â”‚
â”‚   N_LIMIT = None  (full)                 â”‚
â”‚                                          â”‚
â”‚ .venv/bin/python                          â”‚
â”‚   scripts/30_generate_labels_toy_eft_v2.pyâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
         Creates checkpoints_v2/
                 â”‚
                 â–¼

Step 3: Validate Results (5 min)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edit scripts/32_validate_labels.py:      â”‚
â”‚   Line 11: checkpoints_v2                â”‚
â”‚                                          â”‚
â”‚ .venv/bin/python                          â”‚
â”‚   scripts/32_validate_labels.py          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”œâ”€ âœ… Success â‰¥60% â†’ Continue
                 â”‚
                 â””â”€ âŒ <60% â†’ Adjust parameters
                              See ACTION_PLAN.md
                    â”‚
                    â–¼

Step 4: Create Splits (1 min)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ .venv/bin/python                          â”‚
â”‚   scripts/40_make_splits.py              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
         Creates splits/ directory
         â”œâ”€ iid_split.json
         â””â”€ ood_dataset_*.json
                 â”‚
                 â–¼

Step 5: Train Baselines (30-60 min)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ .venv/bin/python                          â”‚
â”‚   scripts/50_train_baseline_tabular.py   â”‚
â”‚                                          â”‚
â”‚ .venv/bin/python                          â”‚
â”‚   scripts/51_train_baseline_graph.py     â”‚
â”‚   (NOW WITH REAL TORIC FEATURES!)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼

Step 6: Check Publication Readiness
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Review validation output:                â”‚
â”‚                                          â”‚
â”‚ âœ… Success rate â‰¥60%                     â”‚
â”‚ âœ… â‰¥3 classes with >5% mass              â”‚
â”‚ âœ… No single class >75%                  â”‚
â”‚ âœ… Both +/- eigenvalues                  â”‚
â”‚ âœ… P95 grad_norm <1e-4                   â”‚
â”‚ âœ… Real graph features                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”œâ”€ 6/6 passed â†’ ğŸ‰ PUBLICATION READY!
                 â”‚
                 â””â”€ <6 â†’ Review failed checks
                         See troubleshooting in ACTION_PLAN.md


KEY IMPROVEMENTS IN V2
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

V1 (Broken)                    V2 (Fixed)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
trust-ncg only          â†’      L-BFGS-B + trust-ncg
500 iterations          â†’      2000 iterations
No multi-start          â†’      3 restarts per sample
No runaway detection    â†’      Large field + uplift checks
No metastability        â†’      Barrier height estimation
torch.randn() features  â†’      Real toric ray values
1.7% success rate       â†’      60-85% success rate
2 classes (98% failed)  â†’      7 classes (diverse)


CRITICAL FILES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Documentation:
  RUN_ME_FIRST.md              â† Start here
  QUICK_REFERENCE.md           â† Quick lookup
  ACTION_PLAN.md               â† Detailed steps
  CRITICAL_FIXES_SUMMARY.md    â† Technical deep-dive
  PIPELINE_FLOW.txt            â† This file

Executable:
  VacuaGym_Complete_Pipeline.ipynb    â† ONE-CLICK SOLUTION
  scripts/test_phase3_v2.py           â† Test before full run
  scripts/30_generate_labels_toy_eft_v2.py  â† Main label generator
  scripts/32_validate_labels.py       â† Quality checker
  scripts/51_train_baseline_graph.py  â† Fixed graph baseline

Output:
  data/processed/labels/toy_eft_stability_v2.parquet
  data/processed/splits/*.json
  data/processed/validation/*.png


VALIDATION CHECKPOINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

During label generation, check:
  â€¢ Success rate increasing over time
  â€¢ Multiple stability classes appearing
  â€¢ Grad norms converging to ~1e-6 to 1e-9

Expected intermediate results (after 1000 samples):
  âœ“ Success: 50-70%
  âœ“ Stable: 30-40%
  âœ“ Saddle: 15-25%
  âœ“ Failed: 20-40%
  âœ“ Other classes: 5-15%

If you see:
  âœ— Success <30% â†’ Increase maxiter
  âœ— Failed >60% â†’ Check optimizer config
  âœ— Stable >80% â†’ Adjust flux parameters


MEMORY OPTIMIZATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If you hit memory issues:

1. Reduce N_LIMIT:
   N_LIMIT = 5000  # Process in chunks

2. Reduce checkpoint interval:
   checkpoint_interval = 50  # Was 100

3. Run garbage collection more often:
   Already implemented in V2

4. Use sequential instead of parallel:
   USE_PARALLEL = False


TROUBLESHOOTING FLOWCHART
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Problem: Still 98% failure in V2
    â”‚
    â”œâ”€â†’ Check: Are you using V2 script?
    â”‚          scripts/30_generate_labels_toy_eft_v2.py
    â”‚
    â””â”€â†’ Check: maxiter = 2000?
               Line 387, 407
        â”‚
        â””â”€â†’ Increase to 5000

Problem: <3 classes with >5%
    â”‚
    â””â”€â†’ Adjust flux parameters
        Lines 125-154 in V2 script
        â€¢ Wider M_flux range
        â€¢ More cross-coupling
        â€¢ Lower gamma

Problem: Graph baseline random features
    â”‚
    â””â”€â†’ Already fixed! Check:
        scripts/51_train_baseline_graph.py
        Lines 106-147 now use real ray values

Problem: Out of memory
    â”‚
    â””â”€â†’ Reduce N_LIMIT or checkpoint_interval

Problem: Import errors
    â”‚
    â””â”€â†’ Install dependencies:
        .venv/bin/pip install scipy pandas numpy scikit-learn


TIME BUDGET
â•â•â•â•â•â•â•â•â•â•â•â•

For TESTING (N_LIMIT=1000):
  â”œâ”€ Test V2:        2 min
  â”œâ”€ Generate:      10 min
  â”œâ”€ Validate:       2 min
  â”œâ”€ Splits:         1 min
  â””â”€ Baselines:      5 min
      TOTAL:       ~20 min

For FULL RUN (N_LIMIT=None, ~270k samples):
  â”œâ”€ Test V2:        2 min
  â”œâ”€ Generate:    2-4 hours  â† Longest step
  â”œâ”€ Validate:       5 min
  â”œâ”€ Splits:         1 min
  â””â”€ Baselines:   30-60 min
      TOTAL:     3-5 hours


SUCCESS CRITERIA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Your dataset is publication-ready when:

âœ… Quantitative:
   â€¢ Success rate â‰¥60%
   â€¢ â‰¥3 classes with >5% mass
   â€¢ Max class percentage <75%
   â€¢ Both positive AND negative eigenvalues present
   â€¢ P95 grad_norm <1e-4
   â€¢ Condition numbers: <5% ill-conditioned

âœ… Qualitative:
   â€¢ Labels correlate with geometry features
   â€¢ Stability distribution makes physical sense
   â€¢ Diagnostic plots look clean
   â€¢ Baselines achieve >random accuracy

âœ… Technical:
   â€¢ Graph baseline uses real toric features
   â€¢ Code is reproducible
   â€¢ Documentation is complete


NEXT STEPS AFTER SUCCESS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Write Paper
   â””â”€â†’ Use framing from CRITICAL_FIXES_SUMMARY.md
       "Benchmark dataset, not real vacua discovery"

2. Additional Experiments
   â”œâ”€â†’ Eigenvalue threshold ablation
   â”œâ”€â†’ n_samples/n_restarts scaling
   â”œâ”€â†’ Uncertainty calibration
   â””â”€â†’ Feature importance analysis

3. Release
   â”œâ”€â†’ Clean repo
   â”œâ”€â†’ Write comprehensive README
   â”œâ”€â†’ Upload to Zenodo (get DOI)
   â”œâ”€â†’ Submit to arXiv
   â””â”€â†’ Submit to journal/conference


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BOTTOM LINE: Open notebook, click "Run All", done!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
